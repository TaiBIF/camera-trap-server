{% extends 'base/base.html' %}
{% block head %}
{% load static %} {% endblock head %} {% block style %}

<link href="{% static 'css/upload_history.css' %}" rel="stylesheet">
<!-- <link href="{% static 'css/theme.css' %}" rel="stylesheet">
<link href="{% static 'js/gsap.min.js' %}" >
<link href="{% static 'js/ScrollTrigger.min.js' %}" >
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script> -->

{% endblock %} 


{% block title %}上傳紀錄 | {% endblock title %}

{% block pop %}

<!--錯誤訊息跳匡-->
<div class="pop-box error-pop d-none">
	<div class="center-box">
		<div class="wbox">
			<div class="xx">
				<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">
					<g id="Group_789" data-name="Group 789" transform="translate(-1679 -599)">
						<g id="Ellipse_4" data-name="Ellipse 4" transform="translate(1679 599)" fill="none" stroke="#257455" stroke-width="2">
							<circle cx="20" cy="20" r="20" stroke="none"/>
							<circle cx="20" cy="20" r="19" fill="none"/>
						</g>
						<g id="Group_712" data-name="Group 712" transform="translate(-133.5 164.5)">
							<line id="Line_1" data-name="Line 1" x1="16" y2="16" transform="translate(1824.5 446.5)" fill="none" stroke="#257455" stroke-linecap="round" stroke-width="2"/>
							<line id="Line_2" data-name="Line 2" x2="16" y2="16" transform="translate(1824.5 446.5)" fill="none" stroke="#257455" stroke-linecap="round" stroke-width="2"/>
						</g>
					</g>
				</svg>
			</div>
			<div class="titlebox">
				請輸入必要資訊
			</div>
			<div class="contentbox">
				<div class="flex-box">
					<img class="icon-1 species-error-icon" src="{% static 'image/misxx.svg' %}" alt="">
					<p class="species-error">物種欄位未完整填寫</p>
					<img class="icon-1 upload-error-icon" src="{% static 'image/misxx.svg' %}" alt="">
					<p class="upload-error">影像未成功上傳</p>
				</div>

				<a href="＃" class="list-dow">
					<svg xmlns="http://www.w3.org/2000/svg" width="25.289" height="23.23" viewBox="0 0 25.289 23.23">
						<g id="Group_791" data-name="Group 791" transform="translate(0 0)">
							<g id="Group_752" data-name="Group 752" transform="translate(0 0)">
								<path id="Path_10218" data-name="Path 10218" d="M12.621,176.606H3.369A3.193,3.193,0,0,1,0,173.205c0-1.358-.005-2.716,0-4.074a1.056,1.056,0,0,1,.939-1.068,1.053,1.053,0,0,1,1.131.814,1.88,1.88,0,0,1,.033.43c0,1.325,0,2.649,0,3.974a1.071,1.071,0,0,0,1.159,1.188q9.383,0,18.766,0a1.063,1.063,0,0,0,1.145-1.168c0-1.347,0-2.694,0-4.04a1.061,1.061,0,1,1,2.106-.015c0,1.358.005,2.716,0,4.074a3.176,3.176,0,0,1-3.248,3.286q-4.708.008-9.416,0" transform="translate(0.001 -153.378)" fill="#FFF"/>
								<path id="Path_10219" data-name="Path 10219" d="M77.93,15.928v-.471q0-7.093,0-14.187a1.869,1.869,0,0,1,.058-.526,1.044,1.044,0,0,1,1.13-.736,1.082,1.082,0,0,1,.934.947,3.792,3.792,0,0,1,.007.4q0,7.077,0,14.154v.43c.517-.411.983-.779,1.446-1.15q1.08-.864,2.158-1.731a1.067,1.067,0,1,1,1.346,1.648q-2.635,2.122-5.279,4.232a1.061,1.061,0,0,1-1.483-.009Q75.672,16.87,73.1,14.8a1.062,1.062,0,1,1,1.313-1.669c1.072.847,2.136,1.7,3.2,2.558.084.067.172.13.313.237" transform="translate(-66.353 -0.001)" fill="#FFF"/>
							</g>
						</g>
					</svg>

					下載錯誤清單
				</a>
			</div>
		</div>
	</div>
</div>

{% endblock pop %}

{% block body %}
<div class="main-box">
	
	<div class="main-title flex-spb">

		<h2>上傳紀錄</h2>
		<div class="search-box">
			<form method="POST" action="/upload-history">
				{% csrf_token %}
				<div class="input-item">
					<input type="text" placeholder="請輸入關鍵字" {% if q != '' %} value="{{ q }}"{% endif %} id="q-text" name="q-text">
					<button class="searchicon" id="q-button">
						<svg xmlns="http://www.w3.org/2000/svg" width="21.061" height="21.061" viewBox="0 0 21.061 21.061">
							<g id="Group_718" data-name="Group 718" transform="translate(-966.939 -1128)">
								<g id="Group_719" data-name="Group 719" transform="translate(968 1128)">
									<g id="Ellipse_5" data-name="Ellipse 5" transform="translate(2)" fill="none" stroke="#257455" stroke-width="1.5">
										<circle cx="9" cy="9" r="9" stroke="none"/>
										<circle cx="9" cy="9" r="8.25" fill="none"/>
									</g>
									<line id="Line_5" data-name="Line 5" x1="5" y2="5" transform="translate(0 15)" fill="none" stroke="#257455" stroke-linecap="round" stroke-width="1.5"/>
								</g>
							</g>
						</svg>
					</button>
				</div>
			</form>
		</div>
	</div>

	<div class="wbg-box marb_50">
		<div class="ov-scroll">
			<table class="upload-table" cellpadding="0" cellspacing="0" border="0">
				<tr>
					<td>
						建立時間
					</td>
					<td>
						最後更新時間
					</td>
					<td>上傳資料夾名稱</td>
					<td>所屬計畫</td>
					<td>樣區</td>
					<td>相機位置</td>
					<td>上傳結果</td>
					<td>詳細</td>
				</tr>
				<tr>
					{% if page_obj %}
					{% for i in page_obj %}
					<tr>
						<td>
							{{ i.0|date:'Y-m-d' }}<br>
							{{ i.0|date:'H:m:s' }}
						</td> 
						<td>
							{{ i.1|date:'Y-m-d' }}<br>
							{{ i.1|date:'H:m:s' }}
						</td>
						<td>{{ i.2 }}</td>
						<td>{{ i.3 }}</td>
						<td>{{ i.4 }}</td>
						<td>{% if i.5 != None %} {{ i.5 }}{% else %}已刪除{% endif%}</td>

					<td>
						<div class="infbox">
						{% if i.6 == 'finished' %}
							<p>已完成</p>
							<img class="icon-2" src="{% static 'image/corrar.svg' %}">
						{% elif i.6 == 'unfinished' %}
							<p>未完成 </p>
							<img class="icon-1" src="{% static 'image/misxx.svg' %}">
						{% elif i.6 == 'uploading' %}
							<p>上傳中 </p>
							<img class="up-icon ms-1" src="{% static 'icon/upload-gray.png' %}" />
						{% endif %}
						</div>
						{% if i.6 == 'unfinished' %}
						<button class="whybox" data-deployment_journal_id="{{ i.8 }}" data-species_error="{{ i.9 }}" data-upload_error="{{ i.10 }}">檢視錯誤</button>
						{% endif %}
					</td>
					<td>
					  {% if i.2 != '' %}
					  <a class="detail-btn" href="{% url 'project_detail' pk=i.7 %}?folder={{ i.2 }}" target="_blank">查看 </a>
					  {% else %}
					  <a class="detail-btn" href="{% url 'project_detail' pk=i.7 %}" target="_blank">查看2 </a>
					  {% endif %}
					</td>
					</tr>
					{% endfor %}
				  	{% else %}
					<tr>
						<td colspan="8">暫無紀錄</td>
					</tr>
				  	{% endif %}
				</tr>
			</table>
		</div>
	</div>
	<div class="page-num">  
		{% if page_obj.has_previous %}
			<a href="?page=1" class="num">1</a>
			<a href="?page={{ page_obj.previous_page_number }}" class="back">
			<svg xmlns="http://www.w3.org/2000/svg" width="9.187" height="17.053" viewBox="0 0 9.187 17.053">
				<g id="pre" transform="translate(111.483 17.054) rotate(180)">
				<g id="Group_17" data-name="Group 17" transform="translate(102.297 0)">
					<path id="Path_59" data-name="Path 59" d="M111.291,8.059,103.417.185a.656.656,0,0,0-.928.928L109.9,8.523l-7.411,7.411a.656.656,0,0,0,.928.928l7.874-7.874A.656.656,0,0,0,111.291,8.059Z" transform="translate(-102.297 0)" fill="#529a81"/>
				</g>
			</svg>
			<p>上一頁</p>
			</a>
		{% endif %}
	
		{% for p in page_range %}
			{% if page_obj.number == p %}
				<a href="?page={{ p }}{% if q %}&q={{ q }}{% endif %}{% if q %}&q={{ q }}{% endif %}" class="num now">{{ p }}</a>
			  {% else %}
				{% if p == page_obj.paginator.ELLIPSIS %}
					<a href="#" class="num">...</a>
				{% else %}
					<a href="?page={{ p }}{% if q %}&q={{ q }}{% endif %}" class="num">{{ p }}</a>
				{% endif %}
			  {% endif %}
		{% endfor %}
	
		{% if page_obj.has_next %}
			<a href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}" class="next">
			<p>下一頁</p>
			<svg xmlns="http://www.w3.org/2000/svg" width="9.187" height="17.053" viewBox="0 0 9.187 17.053">
			<g id="next" transform="translate(-102.297 0)">
			<g id="Group_17" data-name="Group 17" transform="translate(102.297 0)">
				<path id="Path_59" data-name="Path 59" d="M111.291,8.059,103.417.185a.656.656,0,0,0-.928.928L109.9,8.523l-7.411,7.411a.656.656,0,0,0,.928.928l7.874-7.874A.656.656,0,0,0,111.291,8.059Z" transform="translate(-102.297 0)" fill="#529a81"/>
			</g>
			</g>
			</svg>
			</a>
			<a href="?page={{ page_obj.paginator.num_pages }}{% if q %}&q={{ q }}{% endif %}" class="num">{{ page_obj.paginator.num_pages }}</a>
		{% endif %}
	</div>
</div>

<!-- Old version UI -->

<!-- <div class="container content">

	
	<div class="innbox gray-bg">
		<div class="main-box">
			<div class="main-title flex-spb">

				<h2>上傳紀錄</h2>
				<div class="search-box">
                                  <form method="POST" action="/upload-history">
                                    {% csrf_token %}
					<div class="input-item">
						<input type="text" placeholder="請輸入關鍵字"{% if q != '' %} value="{{ q }}"{% endif %} id="q-text" name="q-text">
						<button class="searchicon" id="q-button">
							<svg xmlns="http://www.w3.org/2000/svg" width="21.061" height="21.061" viewBox="0 0 21.061 21.061">
								<g id="Group_718" data-name="Group 718" transform="translate(-966.939 -1128)">
									<g id="Group_719" data-name="Group 719" transform="translate(968 1128)">
										<g id="Ellipse_5" data-name="Ellipse 5" transform="translate(2)" fill="none" stroke="#257455" stroke-width="1.5">
											<circle cx="9" cy="9" r="9" stroke="none"/>
											<circle cx="9" cy="9" r="8.25" fill="none"/>
										</g>
										<line id="Line_5" data-name="Line 5" x1="5" y2="5" transform="translate(0 15)" fill="none" stroke="#257455" stroke-linecap="round" stroke-width="1.5"/>
									</g>
								</g>
							</svg>
						</button>
					</div>
                                  </form>
				</div>
			</div>
			<div class="wbg-box marb_50">
				<div class="ov-scroll">
					<table class="upload-table" cellpadding="0" cellspacing="0" border="0">
					<tr>
						<td>
							建立時間
						</td>
						<td>
							最後更新時間
						</td>
						<td>上傳資料夾名稱</td>
						<td>所屬計畫</td>
						<td>樣區</td>
						<td>相機位置</td>
						<td>上傳結果</td>
						<td>詳細</td>
					</tr>
					<tr>

						{% if page_obj %}
						{% for i in page_obj %}
						<tr>
							<td>
								{{ i.0|date:'Y-m-d' }}<br>
								{{ i.0|date:'H:m:s' }}
							</td> 
							<td>
								{{ i.1|date:'Y-m-d' }}<br>
								{{ i.1|date:'H:m:s' }}
							</td>
							<td>{{ i.2 }}</td>
							<td>{{ i.3 }}</td>
							<td>{{ i.4 }}</td>
							<td>{% if i.5 != None %} {{ i.5 }}{% else %}已刪除{% endif%}</td>

						<td>
							<div class="infbox">
							{% if i.6 == 'finished' %}
								<p>已完成</p>
								<img class="icon-2" src={% static 'image/corrar.svg' %}>
							{% elif i.6 == 'unfinished' %}
								<p>未完成 </p>
								<img class="icon-1" src={% static 'image/misxx.svg' %}>
							{% elif i.6 == 'uploading' %}
								<p>上傳中 </p>
								<img class="up-icon ms-1" src="{% static 'icon/upload-gray.png' %}" />
							{% endif %}
							</div>
                                                        {% if i.6 == 'unfinished' %}
                                                        <button class="whybox setModal" data-deployment_journal_id="{{ i.8 }}" data-species_error="{{ i.9 }}" data-upload_error="{{ i.10 }}">檢視錯誤
                                                        {% endif %}
						</td>
						<td>
						  {% if i.2 != '' %}
						  <a class="detail-btn" href="{% url 'project_detail' pk=i.7 %}?folder={{ i.2 }}" target="_blank">查看 </a>
						  {% else %}
						  <a class="detail-btn" href="{% url 'project_detail' pk=i.7 %}" target="_blank">查看2 </a>
						  {% endif %}
						</td>
						</tr>
						{% endfor %}
					  {% else %}
					  <tr>
						<td colspan="8">暫無紀錄</td>
					  </tr>
					  {% endif %}
					</tr>
				</table>
				</div>
			</div>
		</div> 
	</div> -->





<!-- Modal -->
<!-- <div class="modal fade" id="errorModal">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title title-dark" id="errorModalLabel">錯誤訊息</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<div class="modal-body">
		  <div class="flex-center species-error">
			<img class="up-icon me-1" src="{% static 'icon/upload-fail.png' %}" /> 物種欄位未完整填寫
		  </div>
		  <div class="flex-center upload-error">
			<img class="up-icon me-1" src="{% static 'icon/upload-fail.png' %}" /> 影像未成功上傳
		  </div>
		  <div class="flex-center justify-content-end">
			<img class="me-1 up-icon" src="{% static 'icon/download-green.png' %}" /><a href="" class="link error-link">下載錯誤清單</a>
		  </div>
		</div>
	  </div>
	</div>
  </div> -->
  

<!-- <div class="page-num">  
    {% if page_obj.has_previous %}
		<a href="?page=1" class="num">1</a>
		<a href="?page={{ page_obj.previous_page_number }}" class="back">
		<svg xmlns="http://www.w3.org/2000/svg" width="9.187" height="17.053" viewBox="0 0 9.187 17.053">
			<g id="pre" transform="translate(111.483 17.054) rotate(180)">
			<g id="Group_17" data-name="Group 17" transform="translate(102.297 0)">
				<path id="Path_59" data-name="Path 59" d="M111.291,8.059,103.417.185a.656.656,0,0,0-.928.928L109.9,8.523l-7.411,7.411a.656.656,0,0,0,.928.928l7.874-7.874A.656.656,0,0,0,111.291,8.059Z" transform="translate(-102.297 0)" fill="#529a81"/>
			</g>
		</svg>
		<p>上一頁</p>
		</a>
    {% endif %}

    {% for p in page_range %}
    	{% if page_obj.number == p %}
        	<a href="?page={{ p }}{% if q %}&q={{ q }}{% endif %}{% if q %}&q={{ q }}{% endif %}" class="num now">{{ p }}</a>
      	{% else %}
        	{% if p == page_obj.paginator.ELLIPSIS %}
          		<a href="#" class="num">...</a>
			{% else %}
				<a href="?page={{ p }}{% if q %}&q={{ q }}{% endif %}" class="num">{{ p }}</a>
        	{% endif %}
     	 {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
		<a href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}" class="next">
		<p>下一頁</p>
		<svg xmlns="http://www.w3.org/2000/svg" width="9.187" height="17.053" viewBox="0 0 9.187 17.053">
		<g id="next" transform="translate(-102.297 0)">
		<g id="Group_17" data-name="Group 17" transform="translate(102.297 0)">
			<path id="Path_59" data-name="Path 59" d="M111.291,8.059,103.417.185a.656.656,0,0,0-.928.928L109.9,8.523l-7.411,7.411a.656.656,0,0,0,.928.928l7.874-7.874A.656.656,0,0,0,111.291,8.059Z" transform="translate(-102.297 0)" fill="#529a81"/>
		</g>
		</g>
		</svg>
		</a>
		<a href="?page={{ page_obj.paginator.num_pages }}{% if q %}&q={{ q }}{% endif %}" class="num">{{ page_obj.paginator.num_pages }}</a>
    {% endif %}
</div> -->


{% endblock body %} 
{% block script %}
<script src="{% static 'js/upload_history.js' %}"></script>
{% endblock script %}
	
	
